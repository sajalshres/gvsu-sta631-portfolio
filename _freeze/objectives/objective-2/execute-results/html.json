{
  "hash": "f649df3a0db8f7f78375ee04b856bb32",
  "result": {
    "markdown": "---\ntitle: \"Objective 2\"\n---\n\n\n## 2. Generalized linear model\n\nCourse Objective:\n\n> Determine and apply the appropriate generalized linear model for a specific data context\n\nLogistic regression is a statistical method for analyzing a dataset in which the dependent variable(outcome) is a categorical with two levels. It helps to estimate the probability of an event occurring based on one or more predictor variables. In many ways, logistic regression is an extension of the linear regression model but uses the logistic function to model the relationship between the predictors and the binary outcome.\n\n## 2.1 Example - Sudent Data\n\nFor this example, I will generate a small sample dataset to simulate the student data. I will use the data to fit a logistic regression model using R, and make predictions for a new student.\n\n\n::: {.cell}\n\n:::\n\n\n### 2.1.1 Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the dataset\nstudents <- data.frame(\n  student_id = 1:5,\n  study_hours = c(10, 4, 8, 2, 6),\n  attendance_rate = c(80, 60, 90, 40, 95),\n  pass = c(1, 0, 1, 0, 1)\n)\n\n# Inspect the dataset\nprint(students)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  student_id study_hours attendance_rate pass\n1          1          10              80    1\n2          2           4              60    0\n3          3           8              90    1\n4          4           2              40    0\n5          5           6              95    1\n```\n:::\n:::\n\n\n### 2.1.2 Logistic Regression Model\n\n\n\n```{.r .cell-code}\n# Fit the logistic regression model using glm()\nlogit_model <- glm(pass ~ study_hours + attendance_rate, data = students, family = \"binomial\")\n```\n\n```\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n```\n\n```{.r .cell-code}\ntidy(logit_model) %>% kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -105.843040 </td>\n   <td style=\"text-align:right;\"> 225512.122 </td>\n   <td style=\"text-align:right;\"> -0.0004693 </td>\n   <td style=\"text-align:right;\"> 0.9996255 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> study_hours </td>\n   <td style=\"text-align:right;\"> 4.196698 </td>\n   <td style=\"text-align:right;\"> 23645.195 </td>\n   <td style=\"text-align:right;\"> 0.0001775 </td>\n   <td style=\"text-align:right;\"> 0.9998584 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> attendance_rate </td>\n   <td style=\"text-align:right;\"> 1.098797 </td>\n   <td style=\"text-align:right;\"> 3578.025 </td>\n   <td style=\"text-align:right;\"> 0.0003071 </td>\n   <td style=\"text-align:right;\"> 0.9997550 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n\n\n### 2.1.3 Predictions for New Student\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Predict the probability of passing for a new student with 7 study hours and an 85% attendance rate\nnew_student <- data.frame(study_hours = 7, attendance_rate = 85)\npredicted_probability <- predict(logit_model, newdata = new_student, type = \"response\")\nprint(predicted_probability)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n1 \n1 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthreshold <- 0.5\npredicted_outcome <- ifelse(predicted_probability >= threshold, 1, 0)\nprint(predicted_outcome)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n1 \n1 \n```\n:::\n:::\n\n\nThe `predicted_outcome` is 1, which indicates that the new student will pass the exam. If the `predicted_outcome` is 0, then model predicts failure.\n\n## 2.2 Mini Project - Student Exam Scores\n\nData Source: <http://roycekimmons.com/tools/generated_data/exams>\n\n### 2.2.1 Data Preparation\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the data and make strings as factors\nexam_scores <-\n  as_tibble(read.csv(\"../data/exam_scores.csv\", stringsAsFactors = T))\n\nexam_scores <-\n  exam_scores %>% dplyr::rename(\n    \"ethnicity\" = \"race.ethnicity\",\n    \"parental_education\" = \"parental.level.of.education\",\n    \"test_preparation_course\" = \"test.preparation.course\",\n    \"math_score\" = \"math.score\",\n    \"reading_score\" = \"reading.score\",\n    \"writing_score\" = \"writing.score\"\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(exam_scores) %>% kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> gender </th>\n   <th style=\"text-align:left;\"> ethnicity </th>\n   <th style=\"text-align:left;\"> parental_education </th>\n   <th style=\"text-align:left;\"> lunch </th>\n   <th style=\"text-align:left;\"> test_preparation_course </th>\n   <th style=\"text-align:right;\"> math_score </th>\n   <th style=\"text-align:right;\"> reading_score </th>\n   <th style=\"text-align:right;\"> writing_score </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:left;\"> group D </td>\n   <td style=\"text-align:left;\"> some high school </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 57 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group C </td>\n   <td style=\"text-align:left;\"> some college </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 89 </td>\n   <td style=\"text-align:right;\"> 86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group C </td>\n   <td style=\"text-align:left;\"> associate's degree </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> completed </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group A </td>\n   <td style=\"text-align:left;\"> some college </td>\n   <td style=\"text-align:left;\"> free/reduced </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:left;\"> group B </td>\n   <td style=\"text-align:left;\"> high school </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n   <td style=\"text-align:right;\"> 69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group E </td>\n   <td style=\"text-align:left;\"> bachelor's degree </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> completed </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nInspect the variables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(exam_scores)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\ntibble [1,000 Ã— 8] (S3: tbl_df/tbl/data.frame)\n $ gender                 : Factor w/ 2 levels \"female\",\"male\": 1 2 2 2 1 2 2 1 1 2 ...\n $ ethnicity              : Factor w/ 5 levels \"group A\",\"group B\",..: 4 3 3 1 2 5 4 5 2 2 ...\n $ parental_education     : Factor w/ 6 levels \"associate's degree\",..: 6 5 1 5 3 2 5 3 5 5 ...\n $ lunch                  : Factor w/ 2 levels \"free/reduced\",..: 2 2 2 1 2 2 1 2 2 2 ...\n $ test_preparation_course: Factor w/ 2 levels \"completed\",\"none\": 2 2 1 2 2 1 2 2 1 2 ...\n $ math_score             : int [1:1000] 47 81 77 56 64 66 56 84 77 78 ...\n $ reading_score          : int [1:1000] 56 89 77 59 76 59 55 88 85 68 ...\n $ writing_score          : int [1:1000] 57 86 76 52 69 67 50 85 91 67 ...\n```\n:::\n:::\n\n\nSummary statistics\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(exam_scores) %>% kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:left;\">    gender </th>\n   <th style=\"text-align:left;\">   ethnicity </th>\n   <th style=\"text-align:left;\">          parental_education </th>\n   <th style=\"text-align:left;\">          lunch </th>\n   <th style=\"text-align:left;\"> test_preparation_course </th>\n   <th style=\"text-align:left;\">   math_score </th>\n   <th style=\"text-align:left;\"> reading_score </th>\n   <th style=\"text-align:left;\"> writing_score </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> female:506 </td>\n   <td style=\"text-align:left;\"> group A: 72 </td>\n   <td style=\"text-align:left;\"> associate's degree:199 </td>\n   <td style=\"text-align:left;\"> free/reduced:348 </td>\n   <td style=\"text-align:left;\"> completed:332 </td>\n   <td style=\"text-align:left;\"> Min.   : 12.00 </td>\n   <td style=\"text-align:left;\"> Min.   : 22.00 </td>\n   <td style=\"text-align:left;\"> Min.   : 18.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> male  :494 </td>\n   <td style=\"text-align:left;\"> group B:214 </td>\n   <td style=\"text-align:left;\"> bachelor's degree :115 </td>\n   <td style=\"text-align:left;\"> standard    :652 </td>\n   <td style=\"text-align:left;\"> none     :668 </td>\n   <td style=\"text-align:left;\"> 1st Qu.: 55.00 </td>\n   <td style=\"text-align:left;\"> 1st Qu.: 59.75 </td>\n   <td style=\"text-align:left;\"> 1st Qu.: 58.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> group C:301 </td>\n   <td style=\"text-align:left;\"> high school       :206 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Median : 67.00 </td>\n   <td style=\"text-align:left;\"> Median : 70.00 </td>\n   <td style=\"text-align:left;\"> Median : 69.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> group D:267 </td>\n   <td style=\"text-align:left;\"> master's degree   : 60 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Mean   : 66.27 </td>\n   <td style=\"text-align:left;\"> Mean   : 69.66 </td>\n   <td style=\"text-align:left;\"> Mean   : 68.29 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> group E:146 </td>\n   <td style=\"text-align:left;\"> some college      :243 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> 3rd Qu.: 78.00 </td>\n   <td style=\"text-align:left;\"> 3rd Qu.: 80.00 </td>\n   <td style=\"text-align:left;\"> 3rd Qu.: 79.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> some high school  :177 </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> NA </td>\n   <td style=\"text-align:left;\"> Max.   :100.00 </td>\n   <td style=\"text-align:left;\"> Max.   :100.00 </td>\n   <td style=\"text-align:left;\"> Max.   :100.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe data appears to be clean, as I did not observe any missing values, outliers, or NAs. Therefore, let's prepare the data to perform logistic regression models.\n\nIn below steps, I am adding additional diagnostics:\n.\n\n::: {.cell}\n\n```{.r .cell-code}\nexam_scores <- exam_scores %>%\n  rowwise() %>%\n  mutate(average_score = mean(reading_score, writing_score, math_score))\n\nexam_scores$good_student <-\n  ifelse(exam_scores$average_score > mean(exam_scores$average_score),\n         1,\n         0)\n```\n:::\n\n\nAdd further variables for gender, ethnicity, parental eduction, lunch types and test preb\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexam_scores$is_male <- ifelse(exam_scores$gender == \"male\", 1, 0)\nexam_scores$is_female <-\n  ifelse(exam_scores$gender == \"female\", 1, 0)\n\nexam_scores$ethnicity_A <-\n  ifelse(exam_scores$ethnicity == \"group A\", 1, 0)\nexam_scores$ethnicity_B <-\n  ifelse(exam_scores$ethnicity == \"group B\", 1, 0)\nexam_scores$ethnicity_C <-\n  ifelse(exam_scores$ethnicity == \"group C\", 1, 0)\nexam_scores$ethnicity_D <-\n  ifelse(exam_scores$ethnicity == \"group D\", 1, 0)\nexam_scores$ethnicity_E <-\n  ifelse(exam_scores$ethnicity == \"group E\", 1, 0)\n\nexam_scores$parents_edu_associate <-\n  ifelse(exam_scores$parental_education\n         == \"associate's degree\",\n         1,\n         0)\nexam_scores$parents_edu_bachelor <-\n  ifelse(exam_scores$parental_education\n         == \"bachelor's degree\",\n         1,\n         0)\nexam_scores$parents_edu_hschool <-\n  ifelse(\n    exam_scores$parental_education\n    == \"high school\" |\n      exam_scores$parental_education ==\n      \"some high school\",\n    1,\n    0\n  )\nexam_scores$parents_edu_masters <-\n  ifelse(exam_scores$parental_education\n         == \"master's degree\",\n         1,\n         0)\nexam_scores$parents_edu_college <-\n  ifelse(exam_scores$parental_education\n         == \"some college\", 1, 0)\n\nexam_scores$standard_lunch <-\n  ifelse(exam_scores$lunch == \"standard\", 1, 0)\nexam_scores$subsidised_lunch <-\n  ifelse(exam_scores$lunch == \"free/reduced\", 1, 0)\n\nexam_scores$test_prep_complete <-\n  ifelse(exam_scores$test_preparation_course == \"completed\"\n         , 1, 0)\nhead(exam_scores) %>% kable()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> gender </th>\n   <th style=\"text-align:left;\"> ethnicity </th>\n   <th style=\"text-align:left;\"> parental_education </th>\n   <th style=\"text-align:left;\"> lunch </th>\n   <th style=\"text-align:left;\"> test_preparation_course </th>\n   <th style=\"text-align:right;\"> math_score </th>\n   <th style=\"text-align:right;\"> reading_score </th>\n   <th style=\"text-align:right;\"> writing_score </th>\n   <th style=\"text-align:right;\"> average_score </th>\n   <th style=\"text-align:right;\"> good_student </th>\n   <th style=\"text-align:right;\"> is_male </th>\n   <th style=\"text-align:right;\"> is_female </th>\n   <th style=\"text-align:right;\"> ethnicity_A </th>\n   <th style=\"text-align:right;\"> ethnicity_B </th>\n   <th style=\"text-align:right;\"> ethnicity_C </th>\n   <th style=\"text-align:right;\"> ethnicity_D </th>\n   <th style=\"text-align:right;\"> ethnicity_E </th>\n   <th style=\"text-align:right;\"> parents_edu_associate </th>\n   <th style=\"text-align:right;\"> parents_edu_bachelor </th>\n   <th style=\"text-align:right;\"> parents_edu_hschool </th>\n   <th style=\"text-align:right;\"> parents_edu_masters </th>\n   <th style=\"text-align:right;\"> parents_edu_college </th>\n   <th style=\"text-align:right;\"> standard_lunch </th>\n   <th style=\"text-align:right;\"> subsidised_lunch </th>\n   <th style=\"text-align:right;\"> test_prep_complete </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:left;\"> group D </td>\n   <td style=\"text-align:left;\"> some high school </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 57 </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group C </td>\n   <td style=\"text-align:left;\"> some college </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 89 </td>\n   <td style=\"text-align:right;\"> 86 </td>\n   <td style=\"text-align:right;\"> 89 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group C </td>\n   <td style=\"text-align:left;\"> associate's degree </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> completed </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group A </td>\n   <td style=\"text-align:left;\"> some college </td>\n   <td style=\"text-align:left;\"> free/reduced </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 56 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:left;\"> group B </td>\n   <td style=\"text-align:left;\"> high school </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> none </td>\n   <td style=\"text-align:right;\"> 64 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:right;\"> 76 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:left;\"> group E </td>\n   <td style=\"text-align:left;\"> bachelor's degree </td>\n   <td style=\"text-align:left;\"> standard </td>\n   <td style=\"text-align:left;\"> completed </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe can clean categorical variables as we have added diagnostic variable to build our model/\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- subset(\n  exam_scores,\n  select = -c(\n    gender,\n    ethnicity,\n    parental_education,\n    lunch,\n    test_preparation_course\n  )\n)\n\ndata <- data[, c(6:20, 1:5)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Corelation Analysis\n\ncr <- cor(data)\ncorrplot(cr)\n```\n\n::: {.cell-output-display}\n![](objective-2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\nNow, lets do a forward regression and check significance of each variable as we continue adding to our model:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsplit <- caTools::sample.split(data$good_student, SplitRatio = 0.8)\ntrain_set <-subset(data, split == \"TRUE\")\ntest_set <- subset(data, split == \"FALSE\")\n```\n:::\n\n\n### 2.2.2 Logistic Regression Models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_low <- glm(good_student ~ test_prep_complete,\n                 data = train_set,\n                 family = binomial)\n```\n:::\n\n\nUsing `step` function, I will perform stepwise selection using AIC:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_bestfit <-\n  stats::step(\n    model_low,\n    scope = list(\n      lower = good_student ~ test_prep_complete,\n      upper = good_student ~ test_prep_complete + standard_lunch +\n        is_female + parents_edu_masters + parents_edu_bachelor + ethnicity_E\n    ),\n    direction = \"both\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nStart:  AIC=1077.64\ngood_student ~ test_prep_complete\n\n                       Df Deviance    AIC\n+ standard_lunch        1   1018.7 1024.7\n+ is_female             1   1054.0 1060.0\n+ ethnicity_E           1   1069.0 1075.0\n<none>                      1073.6 1077.6\n+ parents_edu_bachelor  1   1072.4 1078.4\n+ parents_edu_masters   1   1073.6 1079.6\n\nStep:  AIC=1024.73\ngood_student ~ test_prep_complete + standard_lunch\n\n                       Df Deviance    AIC\n+ is_female             1   996.96 1005.0\n+ ethnicity_E           1  1012.48 1020.5\n<none>                     1018.73 1024.7\n+ parents_edu_bachelor  1  1017.67 1025.7\n+ parents_edu_masters   1  1018.58 1026.6\n- standard_lunch        1  1073.64 1077.6\n\nStep:  AIC=1004.96\ngood_student ~ test_prep_complete + standard_lunch + is_female\n\n                       Df Deviance     AIC\n+ ethnicity_E           1   989.24  999.24\n<none>                      996.96 1004.96\n+ parents_edu_bachelor  1   996.00 1006.00\n+ parents_edu_masters   1   996.63 1006.63\n- is_female             1  1018.73 1024.73\n- standard_lunch        1  1053.99 1059.99\n\nStep:  AIC=999.24\ngood_student ~ test_prep_complete + standard_lunch + is_female + \n    ethnicity_E\n\n                       Df Deviance     AIC\n<none>                      989.24  999.24\n+ parents_edu_bachelor  1   988.24 1000.24\n+ parents_edu_masters   1   988.71 1000.71\n- ethnicity_E           1   996.96 1004.96\n- is_female             1  1012.48 1020.48\n- standard_lunch        1  1048.16 1056.16\n```\n:::\n:::\n\n\nLets examine the final best fit model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(model_bestfit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = good_student ~ test_prep_complete + standard_lunch + \n    is_female + ethnicity_E, family = binomial, data = train_set)\n\nCoefficients:\n                   Estimate Std. Error z value Pr(>|z|)    \n(Intercept)         -1.5655     0.1808  -8.661  < 2e-16 ***\ntest_prep_complete   1.0217     0.1657   6.168 6.91e-10 ***\nstandard_lunch       1.2234     0.1648   7.424 1.14e-13 ***\nis_female            0.7343     0.1540   4.767 1.87e-06 ***\nethnicity_E          0.5990     0.2180   2.747  0.00601 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 1108.86  on 799  degrees of freedom\nResidual deviance:  989.24  on 795  degrees of freedom\nAIC: 999.24\n\nNumber of Fisher Scoring iterations: 4\n```\n:::\n:::\n\n\nThe above summary statistics are for the final model selected based on the lowest AIC value. \n\n### ROC Curve\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- predict(model_bestfit, train_set, type = \"response\")\nrocr_pred <- ROCR::prediction(res, train_set$good_student)\nrocr_perf <- ROCR::performance(rocr_pred, \"tpr\", \"fpr\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(rocr_perf,colorize=FALSE, print.cutoffs.at=seq(0.2, by=0.3))\n```\n\n::: {.cell-output-display}\n![](objective-2_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nconfusion_matrix <- table(actual = train_set$good_student,\n                          predicted = res > 0.55)\naccuracy <-\n  (confusion_matrix[2, 2] + confusion_matrix[1, 1]) / (confusion_matrix[2, 2] + confusion_matrix[2, 1] + confusion_matrix[1, 1] + confusion_matrix[1, 2])\naccuracy\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6525\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest_set$good_student <- as.factor(test_set$good_student)\n\nres <- predict(model_bestfit, test_set, type = \"response\")\n\nrocr_pred <- ROCR::prediction(res, test_set$good_student)\nrocr_perf <- ROCR::performance(rocr_pred, \"tpr\", \"fpr\")\nplot(rocr_perf,\n     colorize = FALSE,\n     print.cutoffs.at = seq(0.2, by = 0.3))\n```\n\n::: {.cell-output-display}\n![](objective-2_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "objective-2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}